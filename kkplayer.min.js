/*
* This is NOT a freeware, DO NOT use these code without agreement from the author!
* Author: kookxiang <kookxiang@gmail.com>
*/
function loadKKPlayer(e,t,n,i,r){var o=function(e){return n.createElement(e)},a=function(e,t){e.className=t},u=function(e,t){"undefined"==typeof e.innerText?e.innerHTML=t:e.innerText=t},l=function(e,t){e.appendChild(t)},s=150;if(!e.hasAttribute("inited")&&e.hasAttribute("src")){var c=e.getAttribute("src"),d=o("audio");d.style.display="none",d.preload="none",d.src=c,l(e,d),1==d.volume&&(d.volume=.5);var f=o("div");a(f,"controller");var m=o("button");a(m,"play"),l(f,m);var v=o("div");a(v,"progress-bar");var h=o("div");a(h,"default"),l(v,h);var b=o("div");a(b,"played"),l(v,b);var p=o("div");a(p,"buffered"),l(v,p),l(f,v);var g=o("div");a(g,"timer"),u(g,"00:00"),l(f,g);var y=o("button");a(y,"loop"),l(f,y);var k=o("button");a(k,"show-lyric"),k.setAttribute("disabled","disabled"),u(k,"词"),l(f,k),l(e,f);var F=o("div");a(F,"lyric-box");var T=o("div");e.hasAttribute("height")&&(s=e.getAttribute("height"),T.style.height=s+"px"),a(T,"lyric-box-static"),l(F,T);var C=o("div");a(C,"lyric-static"),l(T,C),e.insertBefore(F,f),e.setAttribute("inited",r);var x=function(e){return Math.min(Math.floor(8*e)/8,100)},w=function(e){var t,n;return t=Math.floor(e/60),10>t&&(t="0"+t),n=Math.floor(e%60),10>n&&(n="0"+n),t+":"+n},q=[],M=!1,A=!1,X=-1,E=0,R=-1,N=n.body.requestFullscreen||n.body.mozRequestFullScreen||n.body.webkitRequestFullscreen||n.body.msRequestFullscreen,S=function(){if(A){var e=q[0>R?0:R];t(C).find(".current").removeClass("current"),t(q[R]).addClass("current");var n=e.offsetTop-q[0].offsetTop-10,i=T.offsetHeight;0>=i&&(i=s);var r=Math.round(i/2-e.offsetHeight),o=0-n+r;C.style.transform="translateY("+o+"px)"}},H=function(){A&&(X=-1,R=-1,E=q[0].time,S(),L())},L=function(){return A&&M?d.currentTime<X?void H():void(d.currentTime<E||R<q.length&&(R++,X=E,E=R==q.length-1?1/0:q[R+1].time,S(),L())):void 0},z=e.getElementsByTagName("Lyric");if(z.length>0){for(var K=0;K<z.length;K++){var W=o("Lyric");W.time=z[K].getAttribute("time"),W.innerHTML=z[K].innerHTML,q[K]=W}t(e).find("Lyric").remove();for(K in q)l(C,q[K]);A=!0,k.removeAttribute("disabled"),H()}var D,P,B=function(){d.paused?t(m).removeClass("pause"):t(m).addClass("pause")},j=function(e){i.requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,10)},O=0,Q=0,Y=function(){if(d.duration&&!(d.duration<=0)){var e;d.buffered.length>0&&(e=100*d.buffered.end(0)/d.duration,O!=e&&(O=e,t(p).width(x(e)+"%"))),e=100*d.currentTime/d.duration,Q!=e&&(Q=e,t(b).width(x(e)+"%"));var n=Math.floor(d.currentTime);d.playedTimeCache!=n&&(d.playedTimeCache=n,t(g).text(w(d.currentTime))),B(),L()}},_=function(){n.exitFullscreen?n.exitFullscreen():n.mozCancelFullScreen?n.mozCancelFullScreen():n.webkitExitFullscreen?n.webkitExitFullscreen():n.msExitFullscreen&&n.msExitFullscreen()},I=function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},U=function(){return n.fullScreen||n.mozFullScreen||n.webkitIsFullScreen||n.msFullscreenElement},G=function(e){return e.preventDefault(),!1},J=function(r,s){V();var c=o("div");a(c,"kk-player-menu");var f=o("a");a(f,"item"),f.href=d.src,f.target="_blank",u(f,"下载歌曲"),f.download="",l(c,f);var m=o("a");a(m,"item"),m.href="#",u(m,"全屏模式"),t(m).on("click",function(t){U()?_():I(e),t.preventDefault()}),N&&l(c,m);var v=o("a");a(v,"item"),v.href="#",u(v,"洗脑循环 "+(d.loop?"ON":"OFF")),t(v).on("click",function(e){t(y).trigger("click"),e.preventDefault()}),l(c,v);var h=o("a");a(h,"item"),h.href="http://go.ikk.me/kkplayer",h.target="_blank",u(h,"关于 KK Player"),l(c,h);var b;b=U()?e:n.body,t(b).prepend(c),c.offsetHeight+s>b.clientHeight&&(s-=c.offsetHeight),c.offsetWidth+r>b.clientWidth&&(r-=c.offsetWidth),c.style.left=r+"px",c.style.top=s+"px",c.className+=" active",t(c).bind("contextmenu",G),t(c).bind("click",V),t(i).bind("blur",V),t(n).bind("click",V),t(n).bind("contextmenu",V)},V=function(){t(".kk-player-menu").removeClass("active"),setTimeout(function(){t(".kk-player-menu").not(".active").remove()},200),t(n).unbind("click",V),t(n).unbind("contextmenu",V),t(i).unbind("blur",V)},Z=function(e){if("touchmove"==e.type&&(e.pageX=e.originalEvent.touches[0].pageX),!(isNaN(d.duration)||d.duration<=0)){var t=d.duration*Math.min(Math.max(D+(e.pageX-P)/h.offsetWidth,0),1);return d.currentTime=Math.round(100*t)/100,j(Y),G(e)}},$=function(e){return t(v).removeClass("no-transition"),t(n).unbind("mousemove",Z),t(n).unbind("touchmove",Z),t(n).unbind("mouseup",$),t(n).unbind("touchend",$),G(e)},ee=function(e){var i="touchstart"==e.type;if(i){e.pageX=e.originalEvent.touches[0].pageX;var o=h;for(e.offsetX=e.pageX-o.offsetLeft;r!==(o=o.offsetParent);)e.offsetX-=o.offsetLeft}if(i||1==e.which){if(!isNaN(d.duration)&&d.duration>0){var a=d.duration*e.offsetX/e.currentTarget.offsetWidth;d.currentTime=Math.round(100*a)/100}return D=d.currentTime/d.duration,P=e.pageX,t(v).addClass("no-transition"),t(n).bind("mousemove",Z),t(n).bind("touchmove",Z),t(n).bind("mouseup",$),t(n).bind("touchend",$),G(e)}},te=function(){t(C).addClass("no-transition"),S(),U()&&!M&&t(k).click(),setTimeout(function(){t(C).removeClass("no-transition")},1)};t(e).on("contextmenu",function(e){return J(e.pageX,e.pageY),G(e)}),t(m).click(function(){d.paused?(d.play(),t(this).addClass("pause"),M||t(k).click()):(d.pause(),t(this).removeClass("pause"))}),t(y).click(function(){d.loop=!d.loop,d.loop?t(this).addClass("enabled"):t(this).removeClass("enabled")}),t(k).click(function(){A&&(U()&&M||(M=!M,M?(t(this).addClass("enabled"),t(F).finish(),t(F).slideDown()):(t(this).removeClass("enabled"),t(F).finish(),t(F).slideUp())))}),t(v).bind("touchstart",ee),t(v).on("mousedown",ee),t(n).on("fullscreenchange",te),t(n).on("webkitfullscreenchange",te),t(n).on("mozfullscreenchange",te),t(n).on("MSFullscreenChange",te),t(d).bind("ended",function(){d.loop||M&&t(k).click(),t(m).removeClass("pause")}),t(d).bind("timeupdate",function(){j(Y)}),e.hasAttribute("autoplay")&&t(m).click()}}!function(e,t){e===t?console.error("Required jQuery support is not available"):e(function(){for(var t=document.getElementsByTagName("kk-player"),n=t.length-1;n>=0;n--)loadKKPlayer(t[n],e,document,window)})}(jQuery);